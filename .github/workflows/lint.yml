name: lint

on:
  push:
    branches:
      - main
      - 'release/**'
  pull_request:

env:
  GO_VERSION: 1.24
  GOTOOLCHAIN: local
  GOOS: linux

jobs:
  go_current:
    timeout-minutes: 5
    name: "go stable"
    runs-on: ubuntu-24.04
    steps:
      # Clone
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683  # v4.2.2
      # Install go
      - name: "Install go"
        uses: ./.github/actions/install-go
        with:
          version: ${{ env.GO_VERSION }}
      # Install dev-tools
      - name: "Install dev-tools"
        uses: ./.github/actions/dev-tools

      - name: imports
        run: make lint-imports
      - name: mod
        run: make lint-mod
      - name: go
        run: make lint-go-all
      - name: go
        # This is duplicating some of the work done in projects-check (which uses an old / buggy version
        # of go-licenses, and also only test for linux).
        run: make lint-licenses-all

  go_canary:
    timeout-minutes: 5
    name: "go canary"
    runs-on: ubuntu-24.04
    env:
      GO_VERSION: canary
    steps:
      # Clone
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683  # v4.2.2
      # Install go
      - name: "Install go"
        uses: ./.github/actions/install-go
        with:
          version: ${{ env.GO_VERSION }}
      # Install dev-tools
      - name: "Install dev-tools"
        uses: ./.github/actions/dev-tools

      - name: imports
        run: make lint-imports
      - name: mod
        run: make lint-mod
      - name: go
        run: make lint-go-all

  other:
    timeout-minutes: 5
    name: "yaml | shell"
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683  # v4.2.2
      - name: make lint-yaml
        run: make lint-yaml
      - name: make lint-shell
        run: make lint-shell
